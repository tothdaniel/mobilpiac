<!DOCTYPE html>
<html>

<head>
    <title>MobilPiactér</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <link href="lib/bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">
    <link href="css/style.css" rel="stylesheet" media="screen">
</head>

<body>
    <div class="navbar navbar-inverse navbar-fixed-top">
        <div class="container">
            <div class="navbar-header">
                <a href="index.html" class="navbar-brand">MobilPiactér</a>
            </div>
            <div class="navbar-collapse collapse">
                <div class="navbar-right navbar-form">
                    <a id="managebtn" style="visibility: hidden;" class="btn btn-default">Telefontípusok menedzselése</a>
                    <a id="newadbtn" class="btn btn-default">Hirdetés feladása</a>
                    <a id="listbtn" href="list_view.html" class="btn btn-default">Listanézet</a>
                    <a id="regbtn" href="registration.html" class="btn btn-default">Regisztráció</a>
                    <a id="logbtn" href="signin.html" class="btn btn-default">Bejelentkezés</a>
                </div>
            </div>
        </div>
    </div>
    <br/>
    <br/>
    <br/>

    <div class="container">

        <div class="row" data-bind="foreach: ad">
            <div class="col-xs-4 col-sm-3 col-md-2 col-lg-2 fixpadding text-center">
                <div class="thumbnail">
                    <img data-bind="attr: {src: image_url, alt: title}" style="width:120px;">
                    <div class="caption text-center">
                        <h3 data-bind="html: title"></h3>
                    </div>
                </div>
                <img src="img/banner-ad-160x600.gif" />
            </div>
            <div class="col-xs-8 col-sm-9 col-md-10 col-lg-10">
                <div class="thumbnail" style="min-height:100px;">
                    <div class="row" style="margin-top:25px;">
                        <div class="col-md-5" style="padding-top: 8px;">
                            <h4 style="display:inline;">Legmagasabb ajánlat:</h4> <span data-bind="html: actual_price"></span> Ft
                        </div>
                        <div class="col-md-6 col-md-push-1">
                            <div class="row">
                                <div class="col-md-6">
                                    <input class="form-control" data-bind="html: next_price_ft, value: next_price" readonly="">
                                </div>
                                <div class="col-md-6">
                                    <button type="button" class="form-control btn-md btn-primary">Licitálok</button>
                                </div>
                            </div>
                        </div>
                        <div class="clearfix"></div><br/>
                        <h4 class="col-md-2">Feladó:</h4>
                        <div class="col-md-4" style="margin-top: 8px;padding-left: 0px;" data-bind="html: seller_user"></div>
                        <h4 class="col-md-3" style="text-align: center;">Feladás ideje:</h4>
                        <div class="col-md-3" style="margin-top: 8px; text-align: center;" data-bind="html: published"></div>
                        <div class="clearfix"></div><br/>
                        <h4 class="col-md-2">Leírás:</h4>
                        <div class="col-md-12" data-bind="html: description">
                        </div>
                    </div>
                </div>
	            <div class="row" data-bind="foreach: mobile_specification">
	                <div class="col-md-6">
                            <div class="thumbnail">
                                <b data-bind="html: name"></b> 
                                <span data-bind="html: value"></span>
                            </div>
	                </div>
	            </div>
            </div>
        </div>

        <hr>

        <footer>
            <p>&copy; DaniPeti 2013</p>
        </footer>
    </div>
    <!-- /container -->

    <script src="lib/jquery-2.0.3.min.js"></script>
    <script src="lib/jquery.cookie.js"></script>
    <script src="lib/knockout-3.0.0.js"></script>
    <script src="lib/bootstrap/js/bootstrap.min.js"></script>
    <script>
            var Ad = function(data) {
                this.actual_price = ko.observable(data.actual_price);
                this.next_price = ko.computed(function() {
                    return data.actual_price + 1000;
                }, this);
                this.next_price_ft = ko.computed(function() {
                    return (data.actual_price + 1000) + " Ft";
                }, this);
                this.published = ko.observable(data.published);
                this.seller_user = ko.observable(data.seller_user);
                this.price = ko.observable(data.price);
                this.image_url = ko.observable(data.image_url);
                this.description = ko.observable(data.description);
                this.title = ko.computed(function() {
                    return data.manufacturer + " " + data.type_name;
                }, this);
                this.mobile_specification = ko.observableArray([]);
                this.mobile_specification.push({
                    name: "Gyártó: ",
                    value: data.manufacturer
                });
                this.mobile_specification.push({
                    name: "Típus neve: ",
                    value: data.type_name
                });
                this.mobile_specification.push({
                    name: "Operációs rendszer: ",
                    value: data.os_name + " " + data.os_version
                });
                this.mobile_specification.push({
                    name: "Képernyő mérete: ",
                    value: data.display_inches + "\""
                });
                this.mobile_specification.push({
                    name: "Felbontás: ",
                    value: data.res_x + "x" + data.res_y + " (" + data.dpi + " dpi)"
                });
                this.mobile_specification.push({
                    name: "Processzor: ",
                    value: data.processor_chipset
                });
                this.mobile_specification.push({
                    name: "Processzor: ",
                    value: data.processor_clock + " Mhz (" + data.processor_number_of_cores + " mag)"
                });
                this.mobile_specification.push({
                    name: "Grafikus processzor: ",
                    value: data.gpu
                });
                this.mobile_specification.push({
                    name: "RAM: ",
                    value: data.ram + " MB RAM"
                });
                this.mobile_specification.push({
                    name: "ROM: ",
                    value: data.rom + " GB Háttértár"
                });
                this.mobile_specification.push({
                    name: "Elülső kamera: ",
                    value: data.front_camera + " Mpx kamera"
                });
                this.mobile_specification.push({
                    name: "Hátsó kamera: ",
                    value: data.rear_camera + " Mpx kamera"
                });
                this.mobile_specification.push({
                    name: "SIM típus: ",
                    value: data.sim_type
                });
                this.mobile_specification.push({
                    name: "MicroSD bővíthetőség: ",
                    value: data.microsd_enabled
                });
            };
            
            function ViewModel() {
                // Data
                var self = this;
                self.ad = ko.observableArray([]);

                // Operations
                $.ajax({
                    url: "/mobilpiac-war/AdHighDetailServlet",
                    type: "get",
                    dataType: "json",
                    data: { id : getURLParameter("phone_id")}
                }).success(function(data) {                 
                    //TODO gondolom itt fogsz majd valahogy adatkotogetni, a data egy JSONObject,
                    //az AdSessionBean getJSONObject(String id) metodusaban latod, mi van neki
                    self.ad.push(new Ad(data));
                }); 
            }

            ko.applyBindings(new ViewModel());
            
            function getURLParameter(name) {
                return decodeURI(
                    (RegExp(name + '=' + '(.+?)(&|$)').exec(location.search)||[,null])[1]
                );
            }
    </script>
    <script>
         $("#logbtn").click(function(event){
            if ($.cookie("login_name") !== undefined && $.cookie("password") !== undefined){
                event.preventDefault();
                $.ajax({
                    url: "/mobilpiac-war/LogoutServlet",
                    type: "get",
                    dataType: "json"
                }).success(function(data) {
                    alert(data.message);
                    if (data.result)
                    {
                        document.location.href="index.html";
                    }
                }); 
            }
         });
         
         $("#managebtn").click(function(event){
            if ($.cookie("login_name") !== undefined && $.cookie("password") !== undefined){
                event.preventDefault();
                var auth = {
                    login_name : $.cookie("login_name"),
                    password : $.cookie("password")
                };
                $.ajax({
                    url: "/mobilpiac-war/CheckAdminServlet",
                    type: "get",
                    dataType: "json",
                    data: auth
                }).success(function(data) {                  
                    if (!data.result)
                    {
                        alert(data.message);
                    }
                    else
                    {
                        document.location.href="manage_phone.html";
                    }
                });  
            }else{
                alert("Ehhez a funkcióhoz be kell jelentkeznie.");
            }
         });
         $("#newadbtn").click(function(event){
            if ($.cookie("login_name") !== undefined && $.cookie("password") !== undefined){
                event.preventDefault();
                document.location.href="new_ad.html"; 
            }else{
                alert("Ehhez a funkcióhoz be kell jelentkeznie.");
            }
         });
         
    </script>
    <script>
        $( document ).ready(function() {
            if ($.cookie("login_name") === undefined || $.cookie("password") === undefined){
                $("#logbtn").html("Bejelentkezés");
                $("#logbtn").attr("href","signin.html");
                $("#managebtn").hide();
                $("#newadbtn").hide();
            }else{
                $("#logbtn").html("Kijelentkezés");
                $("#logbtn").attr("href","#");
                $("#regbtn").hide();
                $("#login_name").html($.cookie("login_name"));
                var auth = {
                    login_name : $.cookie("login_name"),
                    password : $.cookie("password")
                };
                $.ajax({
                    url: "/mobilpiac-war/CheckAdminServlet",
                    type: "get",
                    dataType: "json",
                    data: auth
                }).success(function(data) {                  
                    if (!data.result)
                    {
                        $("#managebtn").css('visibility', 'hidden');
                    }
                    else
                    {
                        $("#managebtn").css('visibility', 'visible');
                    }
                });          
            }
  
        });
    </script>
</body>

</html>