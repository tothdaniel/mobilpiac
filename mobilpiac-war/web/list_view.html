<!DOCTYPE html>
<html>

<head>
    <title>MobilPiactér</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8"> 
    <link href="lib/bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">
    <link href="lib/slider/css/slider.css" rel="stylesheet" media="screen">
    <link href="css/style.css" rel="stylesheet" media="screen">
</head>

<body>
    <div class="navbar navbar-inverse navbar-fixed-top">
        <div class="container">
            <div class="navbar-header">
                <a href="index.html" class="navbar-brand">MobilPiactér</a>
            </div>
            <div class="navbar-collapse collapse">
                <div class="navbar-right navbar-form">
                    <a href="registration.html" class="btn btn-default">Regisztráció</a>
                    <a href="signin.html" class="btn btn-default">Bejelentkezés</a>
                </div>
            </div>
        </div>
    </div>
    <br/><br/><br/>
    
    <div class="container">

        <div class="row">
            <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                <div class="text-center">
                	<div class="thumbnail">
                            <h4 style="margin-top: 5px;">Ár</h4>
                            <input type="text" class="col-sm-10" data-slider-min="10000" data-slider-max="100000" data-slider-step="1000" data-slider-value="[80000,100000]" id="price">
                            <div class="clearfix"></div>
                            <b><span id="minprice">80000</span> Ft - <span id="maxprice">100000</span> Ft</b>
                	</div>
                	<div class="thumbnail multiple-choice">
                            <h4 style="margin-top: 5px;">Szolgáltató</h4>
                            <ul data-bind="foreach: mobileNetworks, visible: mobileNetworks().length > 0">
                                <li>
                                    <label>
                                        <input type="checkbox" name="manufacturer" data-bind="attr:{value: id}"> <span data-bind="html: network_name"></span>
                                    </label>
                                </li>
                            </ul>
                	</div>
                	<div class="thumbnail multiple-choice">
                            <h4 style="margin-top: 5px;">Gyártó</h4>
                            <ul data-bind="foreach: manufacturers, visible: manufacturers().length > 0">
                                <li>
                                    <label>
                                        <input type="checkbox" name="manufacturer" data-bind="attr:{value: id}"> <span data-bind="html: manufacturer_name"></span>
                                    </label>
                                </li>
                            </ul>
                	</div>
                	<div class="thumbnail multiple-choice">
                            <h4 style="margin-top: 5px;">SIM kártya típus</h4>
                            <ul style="height: 70px; overflow: auto;" data-bind="foreach: sims, visible: sims().length > 0">
                                <li>
                                    <label>
                                        <input type="checkbox" name="manufacturer" data-bind="attr:{value: id}"><span data-bind="html: sim_type"></span>
                                    </label>
                                </li>
                            </ul>
                	</div>
                        <div>
                            <a href="#" id="filter" class="btn btn-primary">Szűrés</a>
                        </div>
                </div>
            </div>
            <div class="col-xs-8 col-sm-9 col-md-9 col-lg-9">
                <div class="row" data-bind="foreach: mobiles, visible: mobiles().length > 0">
                    <div class="thumbnail">
                        <div class="row">
                                <h3 data-bind="html: title" class="col-xs-4" style="margin-top: 10px;"></h3>
                                <h3 class="col-xs-push-2 col-xs-5" style="margin-top: 10px; text-align: right;">
                                    Aktuális ár: <span data-bind="html: actual_price"></span> Ft
                                </h3>
                                <div class="clearfix"></div>
                                <img data-bind="attr:{src: image_url}" style="width:50px;float:left;position:relative;margin-left: 16px;margin-right: 5px;">
                                <div data-bind="html: os" class="col-xs-5 thumbnail" style="margin-right: 5px;"></div>
                                <div data-bind="html: rom" class="col-xs-5 thumbnail" style="margin-right: 5px;"></div>
                                <div data-bind="html: screen" class="col-xs-5 thumbnail" style="margin-right: 5px;"></div>
                                <div data-bind="html: ram" class="col-xs-5 thumbnail" style="margin-right: 5px;"></div>
                                <div data-bind="html: processor" class="col-xs-5 thumbnail" style="margin-right: 5px;"></div>
                                <div data-bind="html: rear_camera" class="col-xs-5 thumbnail" style="margin-right: 5px;"></div>
                                <div class="clearfix"></div>
                                <div class="col-xs-4" style="margin-right: 5px;">Feladva: <span data-bind="html: published">2013-06-06 18:18:18</span></div>
                                <div class="col-xs-push-3 col-xs-4" style="margin-right: 5px;text-align: right;">Feladó: <span data-bind="html: seller_user">Én</span></div>
                        </div>
                    </div>					
                </div>
            </div>
        </div>

        <hr>

        <footer>
            <p>&copy; DaniPeti 2013</p>
        </footer>
    </div>
    <!-- /container -->

    <script src="lib/jquery-2.0.3.min.js"></script>
    <script src="lib/knockout-3.0.0.js"></script>
    <script src="lib/bootstrap/js/bootstrap.min.js"></script>
    <script src="lib/slider/js/bootstrap-slider.js"></script>
    <script>
	$(function(){
		var priceChange = function() {
			var newPrice = price.getValue();
			$("#minprice").text(newPrice[0]);
			$("#maxprice").text(newPrice[1]);
		};
		var priceFormat = function(price) {
			return price+" Ft";
		}
		var price = $('#price').slider({formater:priceFormat}).on('slide', priceChange).data('slider');
	});
        var Mobile = function(data) {
            this.actual_price = ko.observable(data.actual_price);
            this.published = ko.observable(data.published);
            this.seller_user = ko.observable(data.seller_user);
            this.price = ko.observable(data.price);
            this.image_url = ko.observable(data.image_url);
            this.title = ko.computed(function() {
                return data.manufacturer + " " + data.type_name;
            }, this);
            this.os = ko.computed(function() {
                return data.os_name + " " + data.os_version;
            }, this);
            this.screen = ko.computed(function() {
                return data.res_x + "x" + data.res_y + " (" + data.dpi + " dpi)";
            }, this);
            this.processor = ko.computed(function() {
                return data.processor_clock + " Mhz (" + data.processor_number_of_cores + " mag)";
            }, this);
            this.ram = ko.computed(function() {
                return data.ram + " GB RAM";
            }, this);
            this.rom = ko.computed(function() {
                return data.rom + " GB Háttértár";
            }, this);
            this.rear_camera = ko.computed(function() {
                return data.rear_camera + " Mpx kamera";
            }, this);
        };
        
        var MobileNetwork = function(data) {
            this.id = ko.observable(data.id);
            this.network_name = ko.observable(data.network_name);
        };
        
        var Manufacturer = function(data) {
            this.id = ko.observable(data.id);
            this.manufacturer_name = ko.observable(data.manufacturer_name);
        };
        
        var Sim = function(data) {
            this.id = ko.observable(data.id);
            this.sim_type = ko.observable(data.sim_type);
        };

        function ViewModel() {
            // Data
            var self = this;
            self.mobiles = ko.observableArray([]);
            self.mobileNetworks = ko.observableArray([]);
            self.manufacturers = ko.observableArray([]);
            self.sims = ko.observableArray([]);

            // Operations
            $.ajax({
                url: "/mobilpiac-war/ListAdsServlet",
                type: "get",
                dataType: "json"
            }).success(function(data) {
                for(key in data.advertisements)
                {
                    self.mobiles.push(new Mobile(data.advertisements[key]));
                }   
            });
            
            $.ajax({
                url: "/mobilpiac-war/ListMobileNetworksServlet",
                type: "get",
                dataType: "json"
            }).success(function(data) {
                for(key in data.mobile_networks)
                {
                    self.mobileNetworks.push(new MobileNetwork(data.mobile_networks[key]));
                }   
            });
            
            $.ajax({
                url: "/mobilpiac-war/ListSimsServlet",
                type: "get",
                dataType: "json"
            }).success(function(data) {
                for(key in data.sims)
                {
                    self.sims.push(new Sim(data.sims[key]));
                }   
            });
            
            $.ajax({
                url: "/mobilpiac-war/ListManufacturersServlet",
                type: "get",
                dataType: "json"
            }).success(function(data) {
                for(key in data.manufacturers)
                {
                    self.manufacturers.push(new Manufacturer(data.manufacturers[key]));
                }   
            });
            
            
        }
        
        //$("#").click(function())

        ko.applyBindings(new ViewModel());
    </script>
</body>

</html>