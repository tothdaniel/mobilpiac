<!DOCTYPE html>
<html>

    <head>
        <title>MobilPiactér</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta charset="utf-8"> 
        <link href="lib/bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">
        <link href="lib/slider/css/slider.css" rel="stylesheet" media="screen">
        <link href="css/style.css" rel="stylesheet" media="screen">
    </head>

    <body>
        <div class="navbar navbar-inverse navbar-fixed-top">
            <div class="container">
                <div class="navbar-header">
                    <a href="index.html" class="navbar-brand">MobilPiactér</a>
                </div>
                <div class="navbar-collapse collapse">
                    <div class="navbar-right navbar-form">
                        <a id="newadbtn" class="btn btn-default">Hirdetés feladása</a>
                        <a id="listbtn" href="list_view.html" class="btn btn-default">Listanézet</a>
                        <a id="regbtn" href="registration.html" class="btn btn-default">Regisztráció</a>
                        <a id="logbtn" href="signin.html" class="btn btn-default">Bejelentkezés</a>
                    </div>
                </div>
            </div>
        </div>
        <br/><br/><br/>

        <div class="container">
            <h2 class="text-center">Telefontípusok menedzselése</h2>
            <div class="row">
                <div class="col-xs-4 col-sm-3 col-md-3 col-lg-3">
                    <div class="text-center">
                        <div class="thumbnail admin-phone-list">
                            <h4 style="margin-top: 5px;">Telefonípusok</h4>
                            <ul data-bind="foreach: mobiles, visible: mobiles().length > 0">
                                <li><a data-bind="html: title" class="btn btn-default"></a></li>
                            </ul>


                            <a class="btn btn-primary">Új telefontípus</a>
                        </div>	
                    </div>
                </div>
                <div class="col-xs-8 col-sm-9 col-md-9 col-lg-9">
                    <div class="form-horizontal">      
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Kép:</label>
                            <div class="col-sm-9">
                                <input type="file" name="file" id="file">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Típus neve:</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" required autofocus="">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Gyártó:</label>
                            <div class="col-sm-8">
                                <select data-bind="foreach: manufacturers, visible: manufacturers().length > 0" class="form-control">
                                    <option data-bind="html: manufacturer_name"></option>
                                </select>
                            </div>
                            <button type="submit" class="btn btn-primary">+</button>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Operációs rendszer:</label>
                            <div class="col-sm-3">
                                <select id="osselect" data-bind="foreach: operationsystems, visible: operationsystems().length > 0" class="form-control">
                                    <option data-bind="html: os_name"></option>
                                </select>
                            </div>
                            <div class="col-sm-1">
                                <button type="submit" class="btn btn-primary">+</button>
                            </div>
                            
                            <div class="col-sm-4">
                                <select data-bind="foreach: osversions, visible: osversions().length > 0" class="form-control">
                                    <option data-bind="html: version_name"></option>
                                </select>
                            </div>
                            <div>
                                <button type="submit" class="btn btn-primary">+</button>
                            </div>
                            
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Processzor:</label>
                            <div class="col-sm-8">
                                <select data-bind="foreach: processors, visible: processors().length > 0" class="form-control">
                                    <option data-bind="html: chipset"></option>
                                </select>
                            </div>
                            <button type="submit" class="btn btn-primary">+</button>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Grafikus processzor:</label>
                            <div class="col-sm-8">
                                <select data-bind="foreach: gpus, visible: gpus().length > 0" class="form-control">
                                    <option data-bind="html: gpu_name"></option>
                                </select>
                            </div>
                            <button type="submit" class="btn btn-primary">+</button>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Sim kártya típus:</label>
                            <div class="col-sm-8">
                                <select data-bind="foreach: sims, visible: sims().length > 0" class="form-control">
                                    <option data-bind="html: sim_type"></option>
                                </select>
                            </div>
                            <button type="submit" class="btn btn-primary">+</button>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">microSD foglalat:</label>
                            <div class="col-sm-8">
                                <select class="form-control">
                                    <option>Van</option>
                                    <option>Nincs</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">RAM mérete (Mb):</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" required autofocus="">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">ROM mérete (Gb):</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" required autofocus="">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Felbontás:</label>
                            <div class="col-sm-3">
                                <input type="text" class="form-control" required autofocus="">
                            </div>
                            <b class="col-sm-2 text-center" style="margin-top:5px;">
                                x
                            </b>
                            <div class="col-sm-3">
                                <input type="text" class="form-control" required autofocus="">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Képpontsűrűség:</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" required autofocus="">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Kijelző mérete:</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" required autofocus="">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Kamera (Mpixel):</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" required autofocus="">
                            </div>
                        </div>
                        <div class="form-group text-center">
                            <button type="submit" class="btn btn-primary">Adatlap mentése</button>
                            <button type="reset" class="btn btn-danger">Törlés</button>
                        </div>
                    </div>
                </div>
            </div>

            <hr>

            <footer>
                <p>&copy; DaniPeti 2013</p>
            </footer>
        </div>
        <!-- /container -->

        <script src="lib/jquery-2.0.3.min.js"></script>
        <script src="lib/jquery.cookie.js"></script>
        <script src="lib/knockout-3.0.0.js"></script>
        <script src="lib/bootstrap/js/bootstrap.min.js"></script>
        <script src="lib/slider/js/bootstrap-slider.js"></script>
        <script>
            var Mobile = function(data) {
                this.actual_price = ko.observable(data.actual_price);
                this.published = ko.observable(data.published);
                this.seller_user = ko.observable(data.seller_user);
                this.price = ko.observable(data.price);
                this.image_url = ko.observable(data.image_url);
                this.title = ko.computed(function() {
                    return data.manufacturer + " " + data.type_name;
                }, this);
                this.manufacturer = ko.observable(data.manufacturer);
                this.type_name = ko.observable(data.type_name);
                this.os = ko.computed(function() {
                    return data.os_name + " " + data.os_version;
                }, this);
                this.screen = ko.computed(function() {
                    return data.res_x + "x" + data.res_y + " (" + data.dpi + " dpi)";
                }, this);
                this.processor = ko.computed(function() {
                    return data.processor_clock + " Mhz (" + data.processor_number_of_cores + " mag)";
                }, this);
                this.ram = ko.computed(function() {
                    return data.ram + " MB RAM";
                }, this);
                this.rom = ko.computed(function() {
                    return data.rom + " GB Háttértár";
                }, this);
                this.rear_camera = ko.computed(function() {
                    return data.rear_camera + " Mpx kamera";
                }, this);
            };

            var Manufacturer = function(data) {
                this.id = ko.observable(data.id);
                this.manufacturer_name = ko.observable(data.manufacturer_name);
            };

            var Sim = function(data) {
                this.id = ko.observable(data.id);
                this.sim_type = ko.observable(data.sim_type);
            };
            
            var Gpu = function(data) {
                this.id = ko.observable(data.id);
                this.gpu_name = ko.observable(data.gpu_name);
            };
            
            var OperationSystem = function(data) {
                this.id = ko.observable(data.id);
                this.os_name = ko.observable(data.os_name);
            };
            
            var OsVersion = function(data) {
                this.id = ko.observable(data.id);
                this.version_name = ko.observable(data.version_name);
            };
            
            var Processor = function(data) {
                this.id = ko.observable(data.id);
                this.chipset = ko.observable(data.chipset);
            };

            function ViewModel() {
                // Data
                var self = this;
                self.mobiles = ko.observableArray([]);
                self.manufacturers = ko.observableArray([]);
                self.sims = ko.observableArray([]);
                self.gpus = ko.observableArray([]);
                self.operationsystems = ko.observableArray([]);
                self.osversions = ko.observableArray([]);
                self.processors = ko.observableArray([]);

                // Operations
                 $.ajax({
                    url: "/mobilpiac-war/ListMobilesServlet",
                    type: "get",
                    dataType: "json"
                }).success(function(data) {
                    for (key in data.mobiles)
                    {
                        self.mobiles.push(new Mobile(data.mobiles[key]));
                    }
                });
                
                $.ajax({
                    url: "/mobilpiac-war/ListSimsServlet",
                    type: "get",
                    dataType: "json"
                }).success(function(data) {
                    for (key in data.sims)
                    {
                        self.sims.push(new Sim(data.sims[key]));
                    }
                });
                
                $.ajax({
                    url: "/mobilpiac-war/ListGpusServlet",
                    type: "get",
                    dataType: "json"
                }).success(function(data) {
                    for (key in data.gpus)
                    {
                        self.gpus.push(new Gpu(data.gpus[key]));
                    }
                });

                $.ajax({
                    url: "/mobilpiac-war/ListManufacturersServlet",
                    type: "get",
                    dataType: "json"
                }).success(function(data) {
                    for (key in data.manufacturers)
                    {
                        self.manufacturers.push(new Manufacturer(data.manufacturers[key]));
                    }
                });
                
                $.ajax({
                    url: "/mobilpiac-war/ListOperationSystemsServlet",
                    type: "get",
                    dataType: "json"
                }).success(function(data) {
                    for (key in data.operationsystems)
                    {
                        self.operationsystems.push(new OperationSystem(data.operationsystems[key]));
                    }
                });
                
                var os = {
                    operation_system: $("#osselect").val()  
                };
                
                $.ajax({
                    url: "/mobilpiac-war/ListOsVersionsServlet",
                    type: "get",
                    dataType: "json",
                    data: {json:JSON.stringify(os)}
                }).success(function(data) {
                    self.osversions.removeAll();
                    for (key in data.osversions)
                    {
                        self.osversions.push(new OsVersion(data.osversions[key]));
                    }
                });
                
                $.ajax({
                    url: "/mobilpiac-war/ListProcessorsServlet",
                    type: "get",
                    dataType: "json"
                }).success(function(data) {
                    for (key in data.processors)
                    {
                        self.processors.push(new Processor(data.processors[key]));
                    }
                });
                //ezzel frissul a verziolista, alapbol az Androidot tolti be
                $("#osselect").change(function(event){
                        event.preventDefault();
                        var os = {
                            operation_system: $("#osselect").val()
                        };
                        $.ajax({
                            url: "/mobilpiac-war/ListOsVersionsServlet",
                            type: "get",
                            dataType: "json",
                            data: {json:JSON.stringify(os)}
                        }).success(function(data) {
                            self.osversions.removeAll();
                            for (key in data.osversions)
                            {
                                self.osversions.push(new OsVersion(data.osversions[key]));
                            }
                        }); 
                 });
                
            }

            ko.applyBindings(new ViewModel());
        </script>   
        <script>
            $("#logbtn").click(function(event) {
                if ($.cookie("login_name") !== undefined && $.cookie("password") !== undefined) {
                    event.preventDefault();
                    $.ajax({
                        url: "/mobilpiac-war/LogoutServlet",
                        type: "get",
                        dataType: "json"
                    }).success(function(data) {
                        alert(data.message);
                        if (data.result)
                        {
                            document.location.href = "index.html";
                        }
                    });
                }
            });

            $("#newadbtn").click(function(event) {
                if ($.cookie("login_name") !== undefined && $.cookie("password") !== undefined) {
                    event.preventDefault();
                    document.location.href = "new_ad.html";
                } else {
                    alert("Ehhez a funkcióhoz be kell jelentkeznie.");
                }
            });
        </script>
        <script>
            $(document).ready(function() {
                if ($.cookie("login_name") === undefined || $.cookie("password") === undefined) {
                    alert("Telefontípusok módosításához be kell jelentkeznie!");
                    document.location.href = "index.html";
                } else {
                    $("#logbtn").html("Kijelentkezés");
                    $("#logbtn").attr("href", "#");
                    $("#regbtn").hide();
                    var auth = {
                        login_name: $.cookie("login_name"),
                        password: $.cookie("password")
                    };
                    $.ajax({
                        url: "/mobilpiac-war/CheckAdminServlet",
                        type: "get",
                        dataType: "json",
                        data: auth
                    }).success(function(data) {
                        if (!data.result)
                        {
                            alert(data.message);
                            document.location.href = "index.html";
                        }
                    });
                }

                var id = {
                    //TODO Peti: ide kell bekotnod az id-t, ez a statikus 1 csak teszteleshez van
                    id: 1
                };
                $.ajax({
                    url: "/mobilpiac-war/PhoneTypeHighDetailServlet",
                    type: "get",
                    dataType: "json",
                    data: id
                }).success(function(data) {
                });

            });

            $(window).load(function() {
                /* if ($.cookie("login_name") === undefined || $.cookie("password") === undefined){
                 $("#logbtn").html("Bejelentkezés");
                 $("#logbtn").attr("href","signin.html");
                 }else{
                 $("#logbtn").html("Kijelentkezés");
                 $("#logbtn").attr("href","#");
                 }*/
            });
        </script>
    </body>

</html>